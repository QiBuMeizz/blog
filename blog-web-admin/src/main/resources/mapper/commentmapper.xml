<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gw.blog.web.admin.dao.CommentDao">

    <sql id="CommentColumns">
        a.id,
        a.name,
        a.email,
        a.text,
        a.pic,
        a.is_parent AS 'isParent',
        a.parent_id AS 'parentId',
        a.content_id AS 'contentId',
        a.status,
        a.created,
        a.updated,
        b.title AS 'content.title',
        c.name AS 'parentName'
    </sql>

    <sql id="LeftJoin">
        LEFT JOIN content AS b ON a.content_id = b.id
        LEFT JOIN comment AS c ON a.parent_id = c.id
    </sql>

    <select id="selectAll" resultType="Comment">
        SELECT
            <include refid="CommentColumns"/>
        FROM comment AS a
            <include refid="LeftJoin"/>
    </select>

    <select id="selectById" resultType="Comment">
        SELECT
         <include refid="CommentColumns"/>
        FROM comment AS a
         <include refid="LeftJoin"/>
        WHERE
          a.status = '1' AND a.id = #{id}
    </select>

    <select id="selectComment" resultType="Comment" parameterType="java.util.Map">
        SELECT
            <include refid="CommentColumns"/>
        FROM comment AS a
            <include refid="LeftJoin"/>
        WHERE
            a.status = '1' AND a.parent_id = #{comment.id} AND a.content_id = #{comment.contentId}
        ORDER BY a.created ASC
        LIMIT #{index},#{size};
    </select>

    <select id="pageList" resultType="Comment">
        SELECT
            <include refid="CommentColumns"/>
        FROM comment AS a
            <include refid="LeftJoin"/>
        Where 1=1
            <if test="status != null and status !=''">
                AND a.status LIKE concat('%',#{status},'%')
            </if>
            <if test="page != null">
                LIMIT #{page.start},#{page.size};
            </if>
    </select>

    <select id="count" resultType="Integer">
        SELECT
            COUNT(*)
        FROM comment AS a
        WHERE 1=1
        <if test="status != null and status !=''">
            AND a.status LIKE concat('%',#{status},'%')
        </if>
    </select>

    

</mapper>